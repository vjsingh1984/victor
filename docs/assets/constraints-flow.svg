<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1F2937">Constraint Enforcement Flow</text>

  <!-- ComputeNode -->
  <rect x="50" y="60" width="200" height="80" rx="10" fill="#ECFDF5" stroke="#059669" stroke-width="2"/>
  <text x="150" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#047857">ComputeNode</text>
  <text x="150" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#065F46">tools: [tool_a, tool_b]</text>
  <text x="150" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#065F46">constraints: {...}</text>

  <!-- Arrow -->
  <line x1="250" y1="100" x2="300" y2="100" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ConstraintsProtocol -->
  <rect x="310" y="60" width="220" height="120" rx="10" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="420" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#92400E">ConstraintsProtocol</text>
  <line x1="330" y1="95" x2="510" y2="95" stroke="#D97706" stroke-width="1"/>
  <text x="420" y="112" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#78350F">allows_tool(name, tier) → bool</text>
  <text x="420" y="127" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#78350F">timeout → float</text>
  <text x="420" y="142" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#78350F">max_tool_calls → int</text>
  <text x="420" y="157" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#78350F">to_dict() → dict</text>

  <!-- Implementations -->
  <rect x="560" y="60" width="200" height="80" rx="8" fill="#DBEAFE" stroke="#3B82F6" stroke-width="2"/>
  <text x="660" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1E40AF">Standard Implementations</text>
  <line x1="575" y1="95" x2="745" y2="95" stroke="#3B82F6" stroke-width="1"/>
  <text x="660" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1E3A8A">• TaskConstraints (default)</text>
  <text x="660" y="123" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1E3A8A">• AirgappedConstraints</text>
  <text x="660" y="136" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1E3A8A">• ComputeOnlyConstraints</text>

  <!-- Arrow from Protocol to Standard -->
  <line x1="530" y1="100" x2="555" y2="100" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Custom extensions box -->
  <rect x="560" y="150" width="200" height="50" rx="8" fill="#FDF2F8" stroke="#EC4899" stroke-width="2"/>
  <text x="660" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#9D174D">Custom Extensions</text>
  <text x="660" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#831843">e.g., InvestmentConstraints</text>

  <!-- Arrow from Protocol to Custom -->
  <line x1="530" y1="140" x2="555" y2="165" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Decision Flow -->
  <rect x="50" y="220" width="700" height="250" rx="12" fill="#F9FAFB" stroke="#E5E7EB" stroke-width="2"/>
  <text x="400" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#374151">Constraint Enforcement at Execution</text>

  <!-- Step 1 -->
  <rect x="80" y="270" width="140" height="60" rx="6" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1.5"/>
  <text x="150" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1E40AF">1. For each tool</text>
  <text x="150" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1E3A8A">in node.tools</text>

  <line x1="220" y1="300" x2="250" y2="300" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Step 2 -->
  <rect x="260" y="270" width="160" height="60" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1.5"/>
  <text x="340" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400E">2. Check constraints</text>
  <text x="340" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#78350F">allows_tool(name)?</text>
  <text x="340" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#78350F">cost_tier ≤ max?</text>

  <!-- Decision diamond -->
  <polygon points="500,300 540,270 580,300 540,330" fill="#E0E7FF" stroke="#4F46E5" stroke-width="1.5"/>
  <text x="540" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#3730A3">Pass?</text>

  <line x1="420" y1="300" x2="495" y2="300" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Yes path -->
  <line x1="580" y1="300" x2="620" y2="300" stroke="#059669" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="600" y="290" font-family="Arial, sans-serif" font-size="9" fill="#059669">Yes</text>

  <rect x="630" y="270" width="100" height="60" rx="6" fill="#ECFDF5" stroke="#059669" stroke-width="1.5"/>
  <text x="680" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#047857">Execute</text>
  <text x="680" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#065F46">tool</text>

  <!-- No path -->
  <line x1="540" y1="330" x2="540" y2="370" stroke="#DC2626" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="555" y="350" font-family="Arial, sans-serif" font-size="9" fill="#DC2626">No</text>

  <rect x="470" y="380" width="140" height="50" rx="6" fill="#FEE2E2" stroke="#DC2626" stroke-width="1.5"/>
  <text x="540" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#991B1B">Skip tool</text>
  <text x="540" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#7F1D1D">Log warning</text>

  <!-- Example YAML -->
  <rect x="80" y="350" width="350" height="100" rx="6" fill="#1F2937"/>
  <text x="95" y="372" font-family="monospace" font-size="9" fill="#9CA3AF"># YAML example</text>
  <text x="95" y="387" font-family="monospace" font-size="9" fill="#10B981">constraints:</text>
  <text x="95" y="402" font-family="monospace" font-size="9" fill="#60A5FA">  llm_allowed: false</text>
  <text x="95" y="417" font-family="monospace" font-size="9" fill="#60A5FA">  max_cost_tier: LOW</text>
  <text x="95" y="432" font-family="monospace" font-size="9" fill="#60A5FA">  timeout: 60</text>
</svg>
