# Copyright 2025 Vijaykumar Singh <singhvjd@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# RAG Vertical Tool Dependencies Configuration
#
# This YAML file defines tool relationships, transitions, clusters, and
# sequences for the RAG (Retrieval-Augmented Generation) vertical.
#
# Migrated from hand-coded Python in victor/rag/tool_dependencies.py

version: "1.0"
vertical: rag

# Tool transition probabilities
# Maps each tool to a list of likely next tools with probability weights
transitions:
  # Reading leads to ingestion or search
  read:
    - tool: rag_ingest
      weight: 0.5
    - tool: rag_search
      weight: 0.2
    - tool: ls
      weight: 0.2
    - tool: read
      weight: 0.1

  # Listing files leads to reading or ingestion
  ls:
    - tool: read
      weight: 0.5
    - tool: rag_ingest
      weight: 0.3
    - tool: ls
      weight: 0.2

  # Web fetch leads to ingestion
  web_fetch:
    - tool: rag_ingest
      weight: 0.6
    - tool: read
      weight: 0.2
    - tool: web_fetch
      weight: 0.2

  # RAG search transitions
  rag_search:
    - tool: rag_query
      weight: 0.4
    - tool: rag_search
      weight: 0.3
    - tool: read
      weight: 0.2
    - tool: rag_list
      weight: 0.1

  # RAG query transitions
  rag_query:
    - tool: rag_search
      weight: 0.4
    - tool: rag_query
      weight: 0.3
    - tool: read
      weight: 0.2
    - tool: rag_stats
      weight: 0.1

  # RAG ingest transitions
  rag_ingest:
    - tool: rag_stats
      weight: 0.3
    - tool: rag_list
      weight: 0.3
    - tool: rag_search
      weight: 0.2
    - tool: read
      weight: 0.2

  # RAG list transitions
  rag_list:
    - tool: rag_search
      weight: 0.4
    - tool: rag_delete
      weight: 0.2
    - tool: rag_stats
      weight: 0.2
    - tool: read
      weight: 0.2

  # RAG delete transitions
  rag_delete:
    - tool: rag_list
      weight: 0.4
    - tool: rag_stats
      weight: 0.3
    - tool: rag_ingest
      weight: 0.3

  # RAG stats transitions
  rag_stats:
    - tool: rag_list
      weight: 0.4
    - tool: rag_search
      weight: 0.3
    - tool: rag_ingest
      weight: 0.2
    - tool: rag_delete
      weight: 0.1

# Tool clusters - groups of tools that work well together
clusters:
  document_reading:
    - read
    - ls
    - web_fetch

  search_operations:
    - rag_search
    - rag_query

  index_management:
    - rag_ingest
    - rag_delete
    - rag_list
    - rag_stats

  content_retrieval:
    - rag_search
    - rag_query
    - read

# Recommended sequences for common RAG tasks
sequences:
  document_ingest:
    - read
    - rag_ingest
    - rag_stats

  web_ingest:
    - web_fetch
    - rag_ingest
    - rag_stats

  batch_ingest:
    - ls
    - read
    - rag_ingest
    - rag_list

  simple_query:
    - rag_query

  thorough_query:
    - rag_search
    - rag_query
    - rag_search

  exploration:
    - rag_stats
    - rag_list
    - rag_search

  cleanup:
    - rag_list
    - rag_delete
    - rag_stats

  maintenance:
    - rag_stats
    - rag_list
    - rag_delete
    - rag_stats

# Tool dependencies - defines which tools depend on or enable others
dependencies:
  - tool: rag_ingest
    depends_on:
      - read
      - web_fetch
    enables:
      - rag_search
      - rag_query
      - rag_list
    weight: 0.7

  - tool: rag_search
    depends_on: []
    enables:
      - rag_query
    weight: 0.6

  - tool: rag_query
    depends_on: []
    enables:
      - rag_search
    weight: 0.6

  - tool: rag_delete
    depends_on:
      - rag_list
    enables:
      - rag_stats
    weight: 0.5

  - tool: rag_list
    depends_on: []
    enables:
      - rag_delete
      - rag_search
    weight: 0.4

  - tool: rag_stats
    depends_on: []
    enables: []
    weight: 0.3

# Required tools for RAG vertical
required_tools:
  - rag_search
  - rag_query
  - rag_ingest

# Optional tools that enhance RAG
optional_tools:
  - read
  - ls
  - web_fetch
  - rag_list
  - rag_delete
  - rag_stats

# Default sequence when task type is unknown
default_sequence:
  - rag_search
  - rag_query

# Metadata for composed patterns
# These represent higher-level operations composed of multiple tool calls
metadata:
  composed_patterns:
    document_ingestion:
      description: "Ingest documents from local files"
      sequence:
        - ls
        - read
        - rag_ingest
        - rag_stats
      inputs:
        - document_path
        - document_type
      outputs:
        - document_ids
        - chunk_count
      weight: 0.9

    web_content_ingestion:
      description: "Ingest content from web URLs"
      sequence:
        - web_fetch
        - rag_ingest
        - rag_stats
      inputs:
        - url
      outputs:
        - document_id
        - chunk_count
      weight: 0.85

    semantic_search:
      description: "Search knowledge base with semantic query"
      sequence:
        - rag_search
        - rag_query
      inputs:
        - query
      outputs:
        - relevant_chunks
        - answer
      weight: 0.9

    comprehensive_query:
      description: "Query with multiple search strategies"
      sequence:
        - rag_search
        - rag_search
        - rag_query
      inputs:
        - query
        - search_strategies
      outputs:
        - answer
        - sources
      weight: 0.85

    index_cleanup:
      description: "Clean up stale documents from index"
      sequence:
        - rag_stats
        - rag_list
        - rag_delete
        - rag_stats
      inputs:
        - cleanup_criteria
      outputs:
        - deleted_count
        - remaining_count
      weight: 0.8

    knowledge_base_audit:
      description: "Audit knowledge base content and statistics"
      sequence:
        - rag_stats
        - rag_list
      inputs: []
      outputs:
        - document_count
        - total_chunks
        - document_list
      weight: 0.75
