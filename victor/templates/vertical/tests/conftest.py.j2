# Copyright 2025 Vijaykumar Singh <singhvjd@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Pytest configuration and fixtures for {{ name }} vertical tests."""

import pytest
from typing import Generator
from unittest.mock import Mock, patch

from victor.{{ name }}.assistant import {{ name_class }}Assistant
from victor.core.verticals import VerticalBase


@pytest.fixture
def mock_vertical() -> Generator[{{ name_class }}Assistant, None, None]:
    """Fixture providing a mocked {{ name_class }}Assistant instance.

    This fixture creates a mock vertical for testing without
    requiring full initialization of dependencies.

    Yields:
        Mocked {{ name_class }}Assistant instance
    """
    with patch.object({{ name_class }}Assistant, "__init__", lambda self: None):
        vertical = {{ name_class }}Assistant.__new__({{ name_class }}Assistant)
        # Set any required attributes
        vertical.name = "{{ name }}"
        vertical.description = "{{ description }}"
        yield vertical
        return


@pytest.fixture
def mock_tools() -> Generator[list, None, None]:
    """Fixture providing mock tools for testing.

    Yields:
        List of mock tool objects
    """
    tools = []
    for i in range(3):
        tool = Mock()
        tool.name = f"mock_tool_{i}"
        tool.description = f"Mock tool {i} for testing"
        tool.parameters = {}
        tool.execute = Mock(return_value={"result": f"tool_{i}_output"})
        tools.append(tool)

    yield tools
    return


@pytest.fixture
def sample_config() -> dict:
    """Fixture providing sample configuration for testing.

    Returns:
        Dictionary with sample vertical configuration
    """
    return {
        "modes": {
            "build": {
                "exploration_factor": 1.0,
                "tool_budget": {"low": 10, "medium": 5, "high": 2},
            },
            "plan": {
                "exploration_factor": 2.5,
                "tool_budget": {"low": 15, "medium": 8, "high": 3},
            },
        },
        "capabilities": [
            "code_analysis",
            "refactoring",
            "documentation",
        ],
    }


@pytest.fixture(autouse=True)
def reset_singletons() -> Generator[None, None, None]:
    """Auto-use fixture to reset singleton state between tests.

    This prevents test pollution by resetting all singleton instances
    before each test runs.

    Yields:
        None
    """
    # Reset code here if needed
    yield
    # Cleanup code here if needed
