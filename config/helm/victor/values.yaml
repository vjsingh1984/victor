# Copyright 2025 Vijaykumar Singh <singhvjd@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Default values for Victor AI
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 3

image:
  repository: vijayksingh/victor
  pullPolicy: Always
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
    - ALL

service:
  type: ClusterIP
  port: 80
  targetPort: http
  metricsPort: 9090

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-request-buffering: "off"
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    nginx.ingress.kubernetes.io/websocket-services: "victor-api"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
  - host: victor.example.com
    paths:
    - path: /
      pathType: Prefix
  tls:
  - secretName: victor-api-tls
    hosts:
    - victor.example.com

resources:
  requests:
    memory: "512Mi"
    cpu: "500m"
  limits:
    memory: "2Gi"
    cpu: "2000m"

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
      - type: Percent
        value: 100
        periodSeconds: 60

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Persistent Storage
persistence:
  enabled: true
  storageClass: fast-ssd
  accessModes:
  - ReadWriteOnce
  size: 10Gi

# Configuration
config:
  # Environment
  environment: "production"
  logLevel: "INFO"
  logFormat: "json"
  logToFile: true
  logFile: "/var/log/victor/app.log"

  # Graph Store
  graphStore: "sqlite"
  graphStorePath: "/home/victor/.victor/data/graph.db"

  # Cache
  cacheDir: "/home/victor/.victor/cache"
  cacheTTL: 3600
  enableCache: true

  # Tool Execution
  maxConcurrentTools: 5
  toolTimeout: 300
  enableParallelExecution: true
  parallelExecutionMaxWorkers: 5

  # Observability
  enableObservability: true
  enablePrometheusExport: true
  prometheusPort: 9090
  enableTracing: false

  # Semantic Search
  enableSemanticSearch: true
  embeddingModel: "BAAI/bge-small-en-v1.5"
  embeddingProvider: "sentence-transformers"
  embeddingCacheEnabled: true

  # Vector Store
  vectorStore: "lancedb"
  vectorStorePath: "/home/victor/.victor/data/vectors"

  # Event Bus
  eventBusBackend: "memory"
  eventBusEnabled: true

  # API
  apiHost: "0.0.0.0"
  apiPort: 8000
  apiWorkers: 1
  apiReload: false

  # CORS
  corsEnabled: true
  corsOrigins: "*"
  corsAllowCredentials: true
  corsAllowMethods: "*"
  corsAllowHeaders: "*"

  # Rate Limiting
  rateLimitEnabled: true
  rateLimitPerMinute: 60
  rateLimitBurst: 100

  # Security
  enableSecurityHeaders: true
  maxRequestSize: 104857600
  timeout: 300

# Secrets
secrets:
  # LLM Provider API Keys
  anthropicApiKey: ""
  openaiApiKey: ""
  googleApiKey: ""
  xaiApiKey: ""
  groqApiKey: ""
  togetherApiKey: ""
  cerebrasApiKey: ""
  deepseekApiKey: ""
  fireworksApiKey: ""
  mistralApiKey: ""
  moonshotApiKey: ""
  openrouterApiKey: ""
  replicateApiKey: ""
  zaiApiKey: ""

  # External Services
  postgresUrl: ""
  redisUrl: ""
  sentryDsn: ""
  datadogApiKey: ""

# Health Probes
livenessProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health/ready
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 0
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 12

# Node Selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app
            operator: In
            values:
            - victor-api
        topologyKey: kubernetes.io/hostname

# Monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
  prometheusRules:
    enabled: true

# Namespace
namespace:
  create: true
  name: victor
