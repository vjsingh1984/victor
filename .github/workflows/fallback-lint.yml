name: Fallback Cap Guard

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  fallback-cap:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Ensure fallback_max_tools bound remains sane
        run: |
          val=$(python - <<'PY'
from pathlib import Path
import re
text = Path("victor/config/settings.py").read_text()
m = re.search(r"fallback_max_tools:\s*int\s*=\s*(\d+)", text)
print(m.group(1) if m else "")
PY
)
          if [ -z "$val" ]; then
            echo "fallback_max_tools not found in settings.py"
            exit 1
          fi
          if [ "$val" -le 0 ] || [ "$val" -gt 20 ]; then
            echo "fallback_max_tools must be between 1 and 20 (found $val)"
            exit 1
          fi
